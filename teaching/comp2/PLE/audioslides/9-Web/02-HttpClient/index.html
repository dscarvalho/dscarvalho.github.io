<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<title>A API HttpClient -- Computação II (MAB240)</title>

	<meta name="description" content="Computação II - Ciência da Computação -- Introdução ao Curso">
	<meta name="author" content="Danilo S. Carvalho">

	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

	<link rel="stylesheet" href="/public/reveal.js/dist/reset.css">
    <link rel="stylesheet" href="/public/reveal.js/dist/reveal.css">
    <link rel="stylesheet" href="/public/reveal.js/dist/theme/white.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="/public/reveal.js/plugin/highlight/monokai.css" id="highlight-theme">
    <link rel="stylesheet" href="/public/css/slides.css">

	<!--[if lt IE 9]>
	<script src="reveal.js/lib/js/html5shiv.js"></script>
	<![endif]-->
</head>

<body>

	<div class="reveal">
		<!-- Any section element inside of this container is displayed as a slide -->
		<div class="slides">
            <section data-background="media/bg.png" data-transition="fade-out" data-menu-title="Título">
                <div class="sl-block" data-block-type="text" style="margin-top: 60px; height: auto; background-color: rgba(106, 226, 106, 0.7); border-radius: 25px;">
                    <div class="sl-block-content" data-placeholder-tag="h3" style="z-index: 11;">
                        <h3>
                            A API HttpClient
                        </h3>
                    </div>
                </div>

                <div class="sl-block" data-block-type="text" style="margin-top: 150px; height: auto; background-color: rgba(255, 255, 255, 0.4);">
                    <div class="sl-block-content" data-placeholder-tag="h4" style="z-index: 10;">
                        <h4>Computação II - Ciência da Computação</h4>
                        <img src="/public/Logo_DCC_CC.svg" style="width: 300px;"/>
                        <br style="line-height: 100%" />
                        <h5 style="font-size: 24pt">Prof.: Danilo S. Carvalho</h5>
                    </div>
                </div>

                <aside class="notes">
                    Olá pessoal.<br />
                    Bem vindos a mais uma aula curso de Computação II do Bacharelado em Ciência da Computação da UFRJ.
                </aside>
            </section>

            <section data-background="media/bg.png" data-transition="fade-out" data-menu-title="Intro">
                <p class="fragment">
                    Nessa aula, vamos aprender sobre como enviar e responder à requisições usando a linguagem Java.
                </p>
                <br/>
                <p class="fragment">
                    Ao final da aula, poderemos construir e enviar requisições usando as classes da API 
                    (Application Programming Interface) HttpClient.
                </p>
            </section>

            <section data-background="media/bg.png" data-transition="fade-out" data-menu-title="API HttpClient">
                <p class="fragment" style="font-size: smaller;">
                    Desde a sua versão 11, a linguagem Java oferece uma maneira simplificada de construir e enviar requisições 
                    HTTP em sua biblioteca padrão: a API <b>HttpClient</b> (java.net.http).
                </p>
                <br/>
                <p class="fragment" style="font-size: smaller;">
                    Uma <b>API</b> (Application Programming Interface) é um conjunto de classes, interfaces e seus métodos, que 
                    juntos atendem a um propósito de facilitar a realização de tarefas específicas pelo programador,
                </p>
                <br/>
                <p class="fragment" style="font-size: smaller;">
                    nesse caso a construção e envio de requisições HTTP e tratamento das respostas.
                </p>
            </section>

            <section data-background="media/bg.png" data-transition="fade-out" data-menu-title="API HttpClient">
                <p class="fragment" style="font-size: smaller;">
                    Os principais módulos da API HttpClient são as classes <b>HttpClient</b>, <b>HttpRequest</b>, e 
                    a interface <b>HttpResponse</b>.
                </p>
            </section>

            <section data-background="media/bg.png" data-transition="fade-out" data-menu-title="Enviando requisições">
                <div class="r-stack">
                    <p class="fragment fade-out" style="font-size: smaller;" data-fragment-index="1" >
                        São utilizadas de forma básica como mostrado à seguir:
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="2" >
                        Uma instância de HttpClient é criada a partir do método <b>newBuilder()</b> da classe HttpClient.
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="3" >
                        O método <b>newBuilder()</b> retorna uma instância de <b>HttpClient.Builder</b> uma classe responsável 
                        pela construção parametrizada de HttpClients (padrão de projeto Builder).
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="4" >
                        Definimos os parâmetros de construção do cliente usando métodos do builder e por fim, usamos o método 
                        <b>build()</b> para criar a instância de HttpClient.
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="5" >
                        Em seguida, precisamos criar uma instância de HttpRequest, para representar a requisição a ser enviada.
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="6" >
                        Similar à classe HttpClient, a classe HttpRequest também possui um builder, que nos permite parametrizar 
                        a criação da requisição.
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="7" >
                        Precisamos incluir no mínimo a URI que queremos requisitar do servidor. Nesse caso, usamos a URL da página 
                        dessa disciplina.
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="8" >
                        Realizamos então o envio da requisição pelo método <b>send()</b> da classe HttpClient.
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="9" >
                        Além da requisição, precisamos passar como argumento um objeto <b>BodyHandler</b> que define como a resposta 
                        do servidor será interpretada, pois há diversos formatos de recursos na Web, e podemos fazer a interpretação 
                        desses recursos no momento da recepção.
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="10" >
                        A interface HttpResponse é parametrizada por esse motivo. <br />
                        Nesse exemplo, vamos apenas ler o conteúdo da resposta como uma string.
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="11" >
                        Entretanto, o envio da requisição pode lançar dois tipos diferentes de exceção: IOException 
                        (se a conexão falhar, por exemplo) e InterruptedException (se a requisição for interrompida por um dos dois lados).
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="12" >
                        Uma informação importante que podemos obter da resposta é o seu código de status. Um código entre 200 e 300 
                        indica que a requisição foi atendida sem problemas. 
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="13" >
                        Já um código diferente indica alguma condição especial: 300 (redirecionamentos), 400 (problemas com a requisição), 
                        500 (problemas com o servidor). Por exemplo, o código 404 indica que o recurso requisitado não foi encontrado.
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="14" >
                        Por fim, podemos acessar o conteúdo da resposta (nesse caso como uma string) usando o método <b>body()</b> 
                        da interface HttpResponse.
                    </p>
                </div>

                <div class="r-stack">
                    <pre data-id="code-animation" style="width: 100%; font-size: 14pt;" class="fragment" data-fragment-index="2">
                        <code class="hljs java" data-trim data-line-numbers > 
                            /*
                            import java.net.*;
                            import java.net.http.*;
                            import java.net.http.HttpClient.*;
                            */

                            ...

                            HttpClient cliente = HttpClient.newBuilder()
                                                           .version(Version.HTTP_2)
                                                           .followRedirects(Redirect.ALWAYS)
                                                           .build();
                        </code>
                    </pre>

                    <pre data-id="code-animation" style="width: 100%; font-size: 14pt;" class="fragment" data-fragment-index="5">
                        <code class="hljs java" data-trim data-line-numbers="14-6" >
                            /*
                            import java.net.*;
                            import java.net.http.*;
                            import java.net.http.HttpClient.*;
                            */

                            ...

                            HttpClient cliente = HttpClient.newBuilder()
                                                           .version(Version.HTTP_2)
                                                           .followRedirects(Redirect.ALWAYS)
                                                           .build();
                            
                            HttpRequest requisicao = HttpRequest.newBuilder()
                                                                .uri(URI.create("http://www.danilosc.ml/teaching/comp2/PLE"))
                                                                .build();
                        </code>
                    </pre>

                    <pre data-id="code-animation" style="width: 100%; font-size: 13pt;" class="fragment" data-fragment-index="8">
                        <code class="hljs java" data-trim data-line-numbers="18" >
                            /*
                            import java.net.*;
                            import java.net.http.*;
                            import java.net.http.HttpClient.*;
                            */

                            ...

                            HttpClient cliente = HttpClient.newBuilder()
                                                           .version(Version.HTTP_2)
                                                           .followRedirects(Redirect.ALWAYS)
                                                           .build();
                            
                            HttpRequest requisicao = HttpRequest.newBuilder()
                                                                .uri(URI.create("http://www.danilosc.ml/teaching/comp2/PLE"))
                                                                .build();

                            HttpResponse&lt;String&gt; resposta = cliente.send(requisicao, HttpResponse.BodyHandlers.ofString());
                        </code>
                    </pre>

                    <pre data-id="code-animation" style="width: 100%; font-size: 13pt;" class="fragment" data-fragment-index="11">
                        <code class="hljs java" data-trim data-line-numbers="19-29" >
                            /*
                            import java.io.IOException;
                            import java.net.*;
                            import java.net.http.*;
                            import java.net.http.HttpClient.*;
                            */

                            ...

                            HttpClient cliente = HttpClient.newBuilder()
                                                           .version(Version.HTTP_2)
                                                           .followRedirects(Redirect.ALWAYS)
                                                           .build();

                            HttpRequest requisicao = HttpRequest.newBuilder()
                                                                .uri(URI.create("http://www.danilosc.ml/teaching/comp2/PLE"))
                                                                .build();

                            try {
                                HttpResponse&lt;String&gt; resposta = cliente.send(requisicao, HttpResponse.BodyHandlers.ofString());
                            } 
                            catch (IOException e) {
                                System.err.println("Problema com a conexão");
                                e.printStackTrace();
                            } 
                            catch (InterruptedException e) {
                                System.err.println("Requisição interrompida");
                                e.printStackTrace();
                            }
                        </code>
                    </pre>

                    <pre data-id="code-animation" style="width: 100%; font-size: 13pt;" class="fragment" data-fragment-index="12">
                        <code class="hljs java" data-trim data-line-numbers="21-24" >
                            /*
                            import java.io.IOException;
                            import java.net.*;
                            import java.net.http.*;
                            import java.net.http.HttpClient.*;
                            */

                            ...

                            HttpClient cliente = HttpClient.newBuilder()
                                                           .version(Version.HTTP_2)
                                                           .followRedirects(Redirect.ALWAYS)
                                                           .build();

                            HttpRequest requisicao = HttpRequest.newBuilder()
                                                                .uri(URI.create("http://www.danilosc.ml/teaching/comp2/PLE"))
                                                                .build();

                            try {
                                HttpResponse&lt;String&gt; resposta = cliente.send(requisicao, HttpResponse.BodyHandlers.ofString());
                                int codStatus = resposta.statusCode();
                                
                                System.out.println(codStatus);
                                System.out.println(resposta.body());
                            } 
                            catch (IOException e) {
                                System.err.println("Problema com a conexão");
                                e.printStackTrace();
                            } 
                            catch (InterruptedException e) {
                                System.err.println("Requisição interrompida");
                                e.printStackTrace();
                            }
                        </code>
                    </pre>
                </div>
            </section>

            <section data-background="media/bg.png" data-transition="fade-out" data-menu-title="Interpretando respostas JSON">
                <div class="r-stack">
                    <p class="fragment fade-out" style="font-size: smaller;" data-fragment-index="1" >
                        Podemos também interpretar o conteúdo da resposta utilizando um interpretador separado, já que nem todo 
                        recurso é um documento HTML.
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="2" >
                        No exemplo abaixo, interpretamos a reposta a uma requisição para o serviço Web de dados sobre COVID-19 
                        como uma string <a href="https://www.json.org/json-pt.html">JSON</a>. A resposta pode ser vista 
                        <a href="https://api.covid19api.com/summary">nesse link</a>.
                    </p>
                    <p class="fragment fade-in-then-out current-visible" style="font-size: smaller;" data-fragment-index="3" >
                        A partir do objeto JSONObject (um mapa recursivo de objetos) da biblioteca 
                        <a href="https://mvnrepository.com/artifact/com.googlecode.json-simple/json-simple/1.1.1">JSON.simple</a>, obtido da interpretação da resposta, podemos 
                        acessar os dados da resposta de forma organizada.
                    </p>
                </div>

                <div class="r-stack">
                    <pre data-id="code-animation" style="width: 100%; font-size: 13pt;" class="fragment" data-fragment-index="2">
                        <code class="hljs java" data-trim data-line-numbers >
                            /*
                            import java.io.IOException;
                            import java.net.*;
                            import java.net.http.*;
                            import java.net.http.HttpClient.*;

                            import org.json.simple.*;
                            import org.json.simple.parser.*;
                            */
                            
                            ...

                            HttpClient cliente = HttpClient.newBuilder()
                                                           .version(Version.HTTP_2)
                                                           .followRedirects(Redirect.ALWAYS)
                                                           .build();

                            HttpRequest requisicao = HttpRequest.newBuilder()
                                                                .uri(URI.create("https://api.covid19api.com/summary"))
                                                                .build();

                            try {
                                HttpResponse&lt;String&gt; resposta = cliente.send(requisicao, HttpResponse.BodyHandlers.ofString());
                                int codStatus = resposta.statusCode();
                                
                                try {
                                    JSONObject respostaJson = (JSONObject) new JSONParser().parse(resposta.body());
                                    JSONArray paises = (JSONArray) respostaJson.get("Countries");
                                    
                                    for (Object pais : paises) {
                                        String nomePais = (String)((JSONObject) pais).get("Country");
                                        if (nomePais.equals("Brazil")) {
                                            System.out.print("Total de mortos: ");
                                            System.out.println(((JSONObject) pais).get("TotalDeaths"));
                                            System.out.print("Total de recuperados: ");
                                            System.out.println(((JSONObject) pais).get("TotalRecovered"));
                                        }
                                    }
                                } 
                                catch (ParseException e) {
                                    System.err.println("Resposta inválida");
                                    e.printStackTrace();
                                }
                            } 
                            catch (IOException e) {
                                System.err.println("Problema com a conexão");
                                e.printStackTrace();
                            } 
                            catch (InterruptedException e) {
                                System.err.println("Requisição interrompida");
                                e.printStackTrace();
                            }
                        </code>
                    </pre>
                </div>
            </section>

            <section data-background="media/bg.png" data-transition="fade-out" data-menu-title="Conclusão">
                <p class="fragment" style="font-size: smaller;">
                    Sabemos agora como criar e enviar uma requisição HTTP usando Java, e também como receber e tratar a resposta 
                    de uma requisição.
                </p>
                <br />
                <p class="fragment" style="font-size: smaller;">
                    Pratique o envio de requisições e a recepção de recursos em diferentes formatos.
                </p>
                <br />
                <p class="fragment" style="font-size: smaller;">
                    Na próxima aula aprenderemos sobre como responder à requisições HTTP usando a API Servlet.
                </p>
            </section>

            <section data-background="media/bg.png" data-transition="fade-out" data-menu-title="Perguntas">
                <p>
                    Perguntas:
                </p>
                <ol class="list-spacing-long">
                    <li style="font-size: smaller;">
                        Que tipo de requisição foi exemplificado nessa aula: GET ou POST? 
                    </li>
                    <li style="font-size: smaller;">
                        Que outro tipo de interpretador podemos usar para tratar as respostas?
                    </li>
                </ol>
            </section>

            <section data-background="media/bg.png" data-transition="fade-out" data-menu-title="Exercício">
                <p>
                    Exercício:
                </p>
                <ol class="list-spacing-long">
                    <li style="font-size: smaller;">
                        Crie uma requisição para baixar a imagem presente na seguinte URL: 
                        <a href="http://musica.ufrj.br/images/logo/ufrj100anos.png">http://musica.ufrj.br/images/logo/ufrj100anos.png</a> <br />
                        e gravá-la em um arquivo local.
                    </li>
                </ol>
            </section>

            <section data-background="media/bg.png" data-transition="fade-out">
				<p style="font-size: larger;">
                    Até a próxima aula!
                </p>
            </section>
		</div>
	</div>

	<!--<script src="../reveal.js/lib/js/head.min.js"></script>-->
    <script src="/public/reveal.js/dist/reveal.js"></script>
    <script src="/public/reveal.js/plugin/zoom/zoom.js"></script>
    <script src="/public/reveal.js/plugin/notes/notes.js"></script>
    <script src="/public/reveal.js/plugin/search/search.js"></script>
    <script src="/public/reveal.js/plugin/markdown/markdown.js"></script>
    <script src="/public/reveal.js/plugin/highlight/highlight.js"></script>

	<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				//mouseWheel: true,
                slideNumber: "c/t",
                showSlideNumber: "all",
				audio: {
					prefix: 'audio/',
					suffix: '.webm',
					defaultDuration: 1,
					textToSpeechURL: null,
					advance: 500,
					autoplay: false,
					defaultNotes: true,
					defaultText: false,
					playerOpacity: 0.2,
				},
				menu: { // Menu works best with font-awesome installed: sudo apt-get install fonts-font-awesome
					themes: false,
					transitions: false,
					markers: true,
					hideMissingTitles: true,
					//custom: [
				    //        { title: 'Plugins', icon: '<i class="fa fa-external-link-alt"></i>', src: 'toc.html' },
				    //        { title: 'About', icon: '<i class="fa fa-info"></i>', src: 'about.html' }
				    //    ]
				},
				//theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				//transition: Reveal.getQueryHash().transition || 'default', // none/fade/slide/convex/concave/zoom

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: '/public/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '/public/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '/public/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); }},
					{ src: '/public/reveal.js-plugins/audio-slideshow/RecordRTC.js', condition: function( ) { return !!document.body.classList; } },				
					{ src: '/public/reveal.js-plugins/audio-slideshow/slideshow-recorder.js', condition: function( ) { return !!document.body.classList; } },				
					{ src: '/public/reveal.js-plugins/audio-slideshow/audio-slideshow.js', condition: function( ) { return !!document.body.classList; } },
					{ src: '/public/reveal.js-plugins/menu/menu.js' },
				],
                
				keyboard: { 
					82: function() { Recorder.toggleRecording(); },	// press 'r' to start/stop recording
					90: function() { Recorder.downloadZip(); }, 	// press 'z' to download zip containing audio files
					84: function() { Recorder.fetchTTS(); } 	// press 't' to fetch TTS audio files
  				},
                
                plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight ]
			});

	</script>
</body>
</html>

